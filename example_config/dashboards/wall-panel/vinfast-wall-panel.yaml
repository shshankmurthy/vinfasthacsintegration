# ========================================
# VinFast EV Wall Panel Dashboard - v8
# ========================================
#
# REQUIRED INTEGRATIONS:
# - VinFast integration (custom_components/vinfast/)
# - Weather integration (built-in HA - Met.no, OpenWeatherMap, etc.)
# - Mobile App (built-in HA - for presence & phone batteries)
# - Map (built-in HA - for vehicle location)
#
# OPTIONAL INTEGRATIONS (can be removed):
# - OCPP Charger integration (lines 177-186, 308-327)
# - Alarm Panel (alarm_control_panel.home_alarm)
# - Garage Door sensor (binary_sensor.garage_door)
# - Camera batteries (lines 683-687, 708-736)
#
# REQUIRED CUSTOM CARDS (install via HACS):
# - button-card
# - layout-card
# - card-mod
#
# ENTITY NAMING:
# Replace ALL entity IDs with your actual entity names:
# - sensor.vinfast_* → your VinFast sensor names
# - person.person_1/person_2 → your person/device_tracker entities
# - sensor.phone_1_battery_level → your phone battery sensors
# - sensor.camera_*_battery_level → your camera battery sensors (optional)
# - alarm_control_panel.home_alarm → your alarm panel (optional)
# - binary_sensor.garage_door → your garage door sensor (optional)
#
# See README.md for full setup instructions
# ========================================

title: Wall Panel
views:
  - title: Home
    path: home
    type: custom:grid-layout
    background: "center / cover no-repeat fixed url('/local/vinfast/vf_bg.png')"
    layout:
      grid-template-columns: minmax(200px, 260px) 1fr 1fr minmax(160px, 200px)
      grid-template-rows: 1fr auto
      grid-template-areas: |
        "timeweather map car status"
        "energy security security battery"
      gap: 12px
      padding: 16px
      margin: 0
      mediaquery:
        "(max-width: 1024px)":
          grid-template-columns: minmax(180px, 220px) 1fr 1fr minmax(140px, 170px)
          grid-template-rows: 1fr auto
          gap: 10px
          padding: 12px
        "(max-width: 800px)":
          grid-template-columns: 1fr 1fr
          grid-template-rows: auto auto auto auto
          grid-template-areas: |
            "timeweather status"
            "map car"
            "security battery"
            "energy energy"
          gap: 8px
          padding: 10px
        "(max-width: 600px)":
          grid-template-columns: 1fr
          grid-template-rows: auto auto auto auto auto auto
          grid-template-areas: |
            "timeweather"
            "car"
            "status"
            "map"
            "security"
            "battery"
          gap: 12px
          padding: 12px
    cards:
      # ===== TIME & WEATHER COMBINED =====
      - type: custom:button-card
        view_layout:
          grid-area: timeweather
        entity: weather.forecast_home
        show_name: false
        show_icon: false
        show_state: false
        triggers_update: all
        styles:
          card:
            - background: none
            - box-shadow: none
            - border: none
            - padding: 10px 16px 10px 0
          grid:
            - grid-template-areas: '"content"'
            - grid-template-columns: 1fr
            - width: 100%
          custom_fields:
            content:
              - width: 100%
        custom_fields:
          content: |
            [[[
              // Time
              const now = new Date();
              const h = now.getHours();
              const hours = (h % 12 || 12).toString();
              const mins = now.getMinutes().toString().padStart(2, '0');
              const ampm = h >= 12 ? 'PM' : 'AM';
              const weekdays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
              const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
              const dayName = weekdays[now.getDay()];
              const monthName = months[now.getMonth()];
              const day = now.getDate();

              // Weather
              const weather = entity;
              const sun = states['sun.sun'];
              const temp = Math.round(weather.attributes.temperature) || '--';
              const condition = weather.state || 'unknown';
              const humidity = weather.attributes.humidity || '--';
              const windSpeed = Math.round(weather.attributes.wind_speed) || '--';
              const windBearing = weather.attributes.wind_bearing || 0;

              // Wind direction
              const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];
              const windDir = directions[Math.round(windBearing / 22.5) % 16];

              // Sunrise/sunset
              const formatTime = (isoString) => {
                if (!isoString) return '--:--';
                const d = new Date(isoString);
                return d.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
              };
              const sunrise = formatTime(sun?.attributes?.next_rising);
              const sunset = formatTime(sun?.attributes?.next_setting);

              // Weather icon
              let icon = 'mdi:weather-cloudy';
              let iconColor = '#64B5F6';
              if (condition.includes('sunny') || condition.includes('clear')) { icon = 'mdi:weather-sunny'; iconColor = '#FFD54F'; }
              else if (condition.includes('partlycloudy')) { icon = 'mdi:weather-partly-cloudy'; iconColor = '#90CAF9'; }
              else if (condition.includes('rain')) { icon = 'mdi:weather-rainy'; iconColor = '#64B5F6'; }
              else if (condition.includes('snow')) { icon = 'mdi:weather-snowy'; iconColor = '#E0E0E0'; }
              else if (condition.includes('cloud')) { icon = 'mdi:weather-cloudy'; iconColor = '#90A4AE'; }
              else if (condition.includes('fog')) { icon = 'mdi:weather-fog'; iconColor = '#B0BEC5'; }

              return `
                <div style="margin-bottom: clamp(16px, 3vw, 24px);">
                  <div style="font-size: clamp(48px, 10vw, 80px); font-weight: 200; color: white; letter-spacing: -3px; line-height: 1; text-shadow: 0 2px 20px rgba(0,0,0,0.5);">${hours}:${mins}<span style="font-size: clamp(20px, 4vw, 32px); color: rgba(255,255,255,0.5); margin-left: 4px;">${ampm}</span></div>
                  <div style="font-size: clamp(14px, 2.5vw, 18px); color: rgba(255,255,255,0.5); margin-top: 4px; font-weight: 400;">${dayName}, ${monthName} ${day}</div>
                </div>

                <div style="display: flex; align-items: center; gap: clamp(10px, 2vw, 16px); margin-bottom: clamp(10px, 2vw, 16px);">
                  <ha-icon icon="${icon}" style="--mdc-icon-size: clamp(40px, 8vw, 56px); color: ${iconColor}; filter: drop-shadow(0 4px 12px rgba(0,0,0,0.4));"></ha-icon>
                  <div>
                    <div style="font-size: clamp(32px, 6vw, 48px); font-weight: 300; color: white; line-height: 1; text-shadow: 0 2px 20px rgba(0,0,0,0.5);">${temp}°</div>
                    <div style="font-size: clamp(11px, 2vw, 14px); color: rgba(255,255,255,0.5); text-transform: capitalize;">${condition}</div>
                  </div>
                </div>

                <div style="display: flex; flex-wrap: wrap; gap: clamp(8px, 1.5vw, 14px); color: rgba(255,255,255,0.5); font-size: clamp(10px, 1.8vw, 13px);">
                  <div style="display: flex; align-items: center; gap: 4px;">
                    <ha-icon icon="mdi:water-percent" style="--mdc-icon-size: clamp(12px, 2vw, 16px); color: rgba(255,255,255,0.4);"></ha-icon>
                    <span>${humidity}%</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 4px;">
                    <ha-icon icon="mdi:weather-windy" style="--mdc-icon-size: clamp(12px, 2vw, 16px); color: rgba(255,255,255,0.4);"></ha-icon>
                    <span>${windDir} ${windSpeed}</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 4px;">
                    <ha-icon icon="mdi:weather-sunset-up" style="--mdc-icon-size: clamp(12px, 2vw, 16px); color: #FFB74D;"></ha-icon>
                    <span>${sunrise}</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 4px;">
                    <ha-icon icon="mdi:weather-sunset-down" style="--mdc-icon-size: clamp(12px, 2vw, 16px); color: #FF8A65;"></ha-icon>
                    <span>${sunset}</span>
                  </div>
                </div>
              `;
            ]]]

      # ===== EV CAR SECTION (Center) - ENHANCED =====
      - type: custom:button-card
        view_layout:
          grid-area: car
        entity: sensor.vinfast_battery
        show_name: false
        show_icon: false
        show_state: false
        tap_action:
          action: none
        hold_action:
          action: navigate
          navigation_path: /wall-panel/cameras
        double_tap_action:
          action: navigate
          navigation_path: /wall-panel/cameras
        styles:
          card:
            - background: transparent
            - box-shadow: none
            - border: none
            - padding: 0
            - cursor: pointer
          custom_fields:
            content:
              - width: 100%
        custom_fields:
          content: |
            [[[
              // Battery and range
              const batt = Math.round(parseFloat(entity.state));
              const range = Math.round(parseFloat(states['sensor.vinfast_range']?.state)) || 0;
              const chargeLimit = Math.round(parseFloat(states['sensor.vinfast_charge_limit']?.state)) || 90;

              // Charging status
              const isCharging = states['binary_sensor.vinfast_charging']?.state === 'on';
              const chargingStatus = states['sensor.vinfast_charging_status']?.state || 'Unknown';
              const timeToFull = parseFloat(states['sensor.vinfast_time_to_full']?.state) || 0;
              const chargingPower = states['sensor.vinfast_charging_power']?.state;

              // OCPP charger data for charging stats row (OPTIONAL - requires OCPP integration)
              // If you don't have OCPP, this row will gracefully hide when not charging
              // Remove lines 177-184 and 307-326 if you want to completely remove OCPP features
              const ocppPower = parseFloat(states['sensor.charger_power_active_import']?.state) || 0;
              const ocppPowerText = ocppPower > 1000 ? (ocppPower/1000).toFixed(1) + ' kW' : ocppPower.toFixed(0) + ' W';
              const ocppSessionKwh = (parseFloat(states['sensor.charger_energy_session']?.state) || 0).toFixed(1);
              const ocppSessionSecs = parseFloat(states['sensor.charger_time_session']?.state) || 0;
              const ocppDurationH = Math.floor(ocppSessionSecs / 3600);
              const ocppDurationM = Math.floor((ocppSessionSecs % 3600) / 60);
              const ocppDurationText = ocppDurationH > 0 ? ocppDurationH + 'h ' + ocppDurationM + 'm' : ocppDurationM + 'm';

              // Temperatures
              const insideTemp = Math.round(parseFloat(states['sensor.vinfast_temperature_2']?.state)) || '--';
              const outsideTemp = Math.round(parseFloat(states['sensor.vinfast_temperature']?.state)) || '--';

              // Vehicle status
              const isLocked = states['binary_sensor.vinfast_locked']?.state === 'off'; // off means locked
              const isPluggedIn = states['binary_sensor.vinfast_plug']?.state === 'on';
              const isIgnitionOn = states['binary_sensor.vinfast_power']?.state === 'on';
              const gear = states['sensor.vinfast_none']?.state || 'P';
              const odometer = Math.round(parseFloat(states['sensor.vinfast_odometer']?.state)) || 0;

              // 12V battery - entity may be named _voltage or _battery_12v depending on HA version
              const battery12v = Math.round(parseFloat(states['sensor.vinfast_voltage']?.state || states['sensor.vinfast_battery_12v']?.state)) || 0;

              // Door/window status
              const doorsOpen = states['binary_sensor.vinfast_door']?.state === 'on';
              const windowsOpen = states['binary_sensor.vinfast_window']?.state === 'on';
              const trunkOpen = states['binary_sensor.vinfast_opening']?.state === 'on';
              const hoodOpen = states['binary_sensor.vinfast_opening_2']?.state === 'on';

              // Location
              const location = states['device_tracker.vinfast_location']?.state || 'unknown';
              const locationText = location === 'home' ? 'Home' : (location === 'not_home' ? 'Away' : location);

              // Battery color
              const getBattColor = (pct) => {
                if (pct < 20) return '#f44336';
                if (pct < 40) return '#FFC107';
                return '#4CAF50';
              };
              const battColor = getBattColor(batt);

              // Tire pressures (FL, FR, RL, RR)
              const fl = parseFloat(states['sensor.vinfast_pressure']?.state) || 0;
              const fr = parseFloat(states['sensor.vinfast_pressure_2']?.state) || 0;
              const rl = parseFloat(states['sensor.vinfast_pressure_3']?.state) || 0;
              const rr = parseFloat(states['sensor.vinfast_pressure_4']?.state) || 0;

              // Pressure color (normal 35-42 PSI for VF8)
              const getPressureColor = (psi) => {
                if (psi < 32 || psi > 45) return '#f44336';
                if (psi < 35 || psi > 42) return '#FFC107';
                return '#4CAF50';
              };

              // Charging time display
              const formatChargingTime = (mins) => {
                if (mins <= 0) return '';
                const h = Math.floor(mins / 60);
                const m = Math.round(mins % 60);
                return h > 0 ? `${h}h ${m}m` : `${m}m`;
              };

              // Last update time - use entity's last_updated
              const lastUpdated = new Date(entity.last_updated);
              const now = new Date();
              const diffMs = now - lastUpdated;
              const diffMins = Math.floor(diffMs / 60000);
              const diffHours = Math.floor(diffMins / 60);

              let lastUpdateText = '';
              if (diffMins < 1) lastUpdateText = 'just now';
              else if (diffMins < 60) lastUpdateText = `${diffMins}m ago`;
              else if (diffHours < 24) lastUpdateText = `${diffHours}h ${diffMins % 60}m ago`;
              else lastUpdateText = `${Math.floor(diffHours/24)}d ago`;

              // Next update (4 hours from last update, or 5 min if charging)
              const updateInterval = isCharging ? 5 : 240; // minutes
              const nextUpdateMs = lastUpdated.getTime() + (updateInterval * 60000);
              const nextUpdate = new Date(nextUpdateMs);
              const timeToNext = Math.max(0, Math.floor((nextUpdateMs - now.getTime()) / 60000));

              let nextUpdateText = '';
              if (timeToNext <= 0) nextUpdateText = 'due now';
              else if (timeToNext < 60) nextUpdateText = `in ${timeToNext}m`;
              else nextUpdateText = `in ${Math.floor(timeToNext/60)}h ${timeToNext % 60}m`;

              // Stale data warning (> 5 hours old)
              const isStale = diffHours >= 5;

              return `
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: clamp(6px, 1.5vw, 12px); padding: 0 clamp(6px, 1.5vw, 12px);">
                  <div style="position: relative;">
                    <img src="/local/vinfast/vf8.png" style="width: clamp(140px, 32vw, 340px); height: auto; filter: drop-shadow(0 10px 30px rgba(0,0,0,0.6));">
                    ${isCharging ? '<div style="position: absolute; top: 10px; right: 10px; animation: pulse 1.5s ease-in-out infinite;"><ha-icon icon="mdi:lightning-bolt" style="--mdc-icon-size: 28px; color: #4CAF50; filter: drop-shadow(0 0 8px rgba(76,175,80,0.8));"></ha-icon></div>' : ''}
                    ${doorsOpen || windowsOpen || trunkOpen || hoodOpen ? '<div style="position: absolute; top: 10px; left: 10px;"><ha-icon icon="mdi:car-door" style="--mdc-icon-size: 24px; color: #FFC107;"></ha-icon></div>' : ''}
                  </div>
                  <div style="text-align: right; padding-top: 8px;">
                    <div style="font-size: clamp(36px, 7vw, 64px); font-weight: 300; color: ${battColor}; line-height: 1; text-shadow: 0 2px 20px rgba(0,0,0,0.3);">${batt}%</div>
                    <div style="font-size: clamp(14px, 2.5vw, 20px); color: rgba(255,255,255,0.6); margin-top: clamp(2px, 0.5vw, 4px);">${range} mi</div>
                    <div style="display: flex; justify-content: flex-end; align-items: center; gap: 6px; margin-top: 8px;">
                      <ha-icon icon="mdi:thermometer" style="--mdc-icon-size: 14px; color: #64B5F6;"></ha-icon>
                      <span style="font-size: 12px; color: rgba(255,255,255,0.6);">${insideTemp}°F</span>
                      <ha-icon icon="mdi:thermometer-low" style="--mdc-icon-size: 14px; color: #90CAF9; margin-left: 4px;"></ha-icon>
                      <span style="font-size: 12px; color: rgba(255,255,255,0.6);">${outsideTemp}°F</span>
                    </div>
                  </div>
                </div>

                <div style="display: flex; justify-content: center; align-items: center; gap: clamp(6px, 1.5vw, 12px); margin-bottom: clamp(6px, 1.5vw, 10px);">
                  <span style="font-size: clamp(10px, 1.8vw, 13px); display: flex; align-items: center; gap: 4px;">
                    <ha-icon icon="mdi:tire" style="--mdc-icon-size: clamp(12px, 2vw, 16px); color: rgba(255,255,255,0.4);"></ha-icon>
                    <span style="color: rgba(255,255,255,0.5);">FL</span><span style="color: ${getPressureColor(fl)};">${fl.toFixed(0)}</span>
                  </span>
                  <span style="font-size: clamp(10px, 1.8vw, 13px);"><span style="color: rgba(255,255,255,0.5);">FR</span> <span style="color: ${getPressureColor(fr)};">${fr.toFixed(0)}</span></span>
                  <span style="font-size: clamp(10px, 1.8vw, 13px);"><span style="color: rgba(255,255,255,0.5);">RL</span> <span style="color: ${getPressureColor(rl)};">${rl.toFixed(0)}</span></span>
                  <span style="font-size: clamp(10px, 1.8vw, 13px);"><span style="color: rgba(255,255,255,0.5);">RR</span> <span style="color: ${getPressureColor(rr)};">${rr.toFixed(0)}</span></span>
                  <span style="font-size: clamp(9px, 1.6vw, 12px); color: rgba(255,255,255,0.4);">PSI</span>
                </div>

                <div style="background: rgba(255,255,255,0.05); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); border-radius: clamp(12px, 2.5vw, 20px); padding: clamp(10px, 2vw, 16px); box-shadow: 0 8px 32px rgba(0,0,0,0.3);">

                  <!-- Battery bar with charge limit marker -->
                  <div style="position: relative; width: 100%; height: clamp(8px, 1.5vw, 12px); background: rgba(255,255,255,0.1); border-radius: 6px; margin-bottom: clamp(6px, 1.2vw, 10px);">
                    <div style="position: absolute; left: 0; top: 0; height: 100%; width: ${batt}%; background: ${battColor}; border-radius: 6px; ${isCharging ? 'animation: charging-pulse 2s ease-in-out infinite;' : ''}"></div>
                    <div style="position: absolute; left: ${chargeLimit}%; top: -2px; bottom: -2px; width: 2px; background: rgba(255,255,255,0.6);"></div>
                    <div style="position: absolute; left: ${batt}%; top: 50%; transform: translate(-50%, -50%); width: clamp(12px, 2vw, 16px); height: clamp(12px, 2vw, 16px); background: white; border-radius: 50%; box-shadow: 0 2px 8px rgba(0,0,0,0.4);"></div>
                    <div style="position: absolute; left: ${chargeLimit}%; top: -18px; transform: translateX(-50%); font-size: 9px; color: rgba(255,255,255,0.5);">${chargeLimit}%</div>
                  </div>

                  <!-- Charging stats row (OPTIONAL - only when charging, requires OCPP integration) -->
                  <!-- If you don't have OCPP, remove this entire block (lines 306-326) -->
                  ${isCharging ? `
                  <div style="display: flex; justify-content: space-around; align-items: center; padding: clamp(6px, 1.2vw, 10px) clamp(8px, 1.5vw, 12px); border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: clamp(6px, 1.2vw, 10px); font-size: clamp(9px, 1.6vw, 12px); color: rgba(255,255,255,0.7); background: rgba(76,175,80,0.08); border-radius: 8px;">
                    <div style="display: flex; align-items: center; gap: 4px;">
                      <ha-icon icon="mdi:lightning-bolt" style="--mdc-icon-size: clamp(11px, 2vw, 14px); color: #4CAF50;"></ha-icon>
                      <span style="color: #4CAF50; font-weight: 500;">${ocppPowerText}</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 4px;">
                      <ha-icon icon="mdi:battery-charging" style="--mdc-icon-size: clamp(11px, 2vw, 14px); color: #4CAF50;"></ha-icon>
                      <span style="color: #4CAF50; font-weight: 500;">${ocppSessionKwh} kWh</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 4px;">
                      <ha-icon icon="mdi:battery-clock" style="--mdc-icon-size: clamp(11px, 2vw, 14px); color: #64B5F6;"></ha-icon>
                      <span style="color: #64B5F6;">${timeToFull > 0 ? formatChargingTime(timeToFull) : '--'}</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 4px;">
                      <ha-icon icon="mdi:timer-outline" style="--mdc-icon-size: clamp(11px, 2vw, 14px); color: rgba(255,255,255,0.5);"></ha-icon>
                      <span>${ocppDurationText}</span>
                    </div>
                  </div>
                  ` : ''}

                  <!-- Status row -->
                  <div style="display: flex; justify-content: space-between; align-items: center; padding: clamp(4px, 1vw, 8px) 0; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: clamp(8px, 1.5vw, 12px); font-size: clamp(10px, 1.8vw, 13px); color: rgba(255,255,255,0.7);">
                    <div style="display: flex; align-items: center; gap: clamp(4px, 1vw, 8px);">
                      <ha-icon icon="${location === 'home' ? 'mdi:home' : 'mdi:map-marker'}" style="--mdc-icon-size: clamp(12px, 2vw, 16px); color: ${location === 'home' ? '#4CAF50' : '#64B5F6'};"></ha-icon>
                      <span>${locationText}</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: clamp(4px, 1vw, 8px);">
                      <ha-icon icon="mdi:steering" style="--mdc-icon-size: clamp(12px, 2vw, 16px); color: rgba(255,255,255,0.5);"></ha-icon>
                      <span>${odometer.toLocaleString()} mi</span>
                      <span style="color: rgba(255,255,255,0.3);">|</span>
                      <ha-icon icon="mdi:car-battery" style="--mdc-icon-size: clamp(12px, 2vw, 16px); color: ${battery12v < 50 ? '#FFC107' : 'rgba(255,255,255,0.5)'};"></ha-icon>
                      <span style="color: ${battery12v < 50 ? '#FFC107' : 'rgba(255,255,255,0.7)'};">${battery12v}%</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: clamp(4px, 1vw, 8px);">
                      ${isPluggedIn ? '<ha-icon icon="mdi:ev-plug-type1" style="--mdc-icon-size: clamp(12px, 2vw, 16px); color: #4CAF50;"></ha-icon>' : ''}
                      ${isCharging
                        ? `<span style="color: #4CAF50;">Charging</span>`
                        : `<span>${chargingStatus}</span>`
                      }
                    </div>
                  </div>

                  <!-- Action buttons - now show status -->
                  <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: clamp(6px, 1.2vw, 10px);">
                    <!-- Ignition/Gear status -->
                    <div style="display: flex; flex-direction: column; align-items: center; padding: clamp(8px, 1.5vw, 12px) clamp(3px, 0.6vw, 6px); background: ${isIgnitionOn ? 'rgba(76,175,80,0.2)' : 'rgba(255,255,255,0.05)'}; border: 1px solid ${isIgnitionOn ? 'rgba(76,175,80,0.4)' : 'rgba(255,255,255,0.15)'}; border-radius: clamp(8px, 1.5vw, 12px);">
                      <div style="width: clamp(28px, 5vw, 40px); height: clamp(28px, 5vw, 40px); border: 2px solid ${isIgnitionOn ? '#4CAF50' : 'rgba(255,255,255,0.3)'}; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: clamp(2px, 0.5vw, 4px);">
                        <span style="font-size: clamp(14px, 2.5vw, 20px); font-weight: 600; color: ${isIgnitionOn ? '#4CAF50' : 'rgba(255,255,255,0.7)'};">${gear}</span>
                      </div>
                      <span style="font-size: clamp(8px, 1.5vw, 11px); color: ${isIgnitionOn ? '#4CAF50' : 'rgba(255,255,255,0.6)'};">${isIgnitionOn ? 'Running' : 'Off'}</span>
                    </div>

                    <!-- Lock status -->
                    <div style="display: flex; flex-direction: column; align-items: center; padding: clamp(8px, 1.5vw, 12px) clamp(3px, 0.6vw, 6px); background: ${isLocked ? 'rgba(76,175,80,0.2)' : 'rgba(255,193,7,0.2)'}; border: 1px solid ${isLocked ? 'rgba(76,175,80,0.4)' : 'rgba(255,193,7,0.4)'}; border-radius: clamp(8px, 1.5vw, 12px);">
                      <div style="width: clamp(28px, 5vw, 40px); height: clamp(28px, 5vw, 40px); border: 2px solid ${isLocked ? '#4CAF50' : '#FFC107'}; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: clamp(2px, 0.5vw, 4px);">
                        <ha-icon icon="${isLocked ? 'mdi:lock' : 'mdi:lock-open'}" style="--mdc-icon-size: clamp(14px, 2.5vw, 20px); color: ${isLocked ? '#4CAF50' : '#FFC107'};"></ha-icon>
                      </div>
                      <span style="font-size: clamp(8px, 1.5vw, 11px); color: ${isLocked ? '#4CAF50' : '#FFC107'};">${isLocked ? 'Locked' : 'Unlocked'}</span>
                    </div>

                    <!-- Plug status -->
                    <div style="display: flex; flex-direction: column; align-items: center; padding: clamp(8px, 1.5vw, 12px) clamp(3px, 0.6vw, 6px); background: ${isPluggedIn ? 'rgba(76,175,80,0.2)' : 'rgba(255,255,255,0.05)'}; border: 1px solid ${isPluggedIn ? 'rgba(76,175,80,0.4)' : 'rgba(255,255,255,0.15)'}; border-radius: clamp(8px, 1.5vw, 12px);">
                      <div style="width: clamp(28px, 5vw, 40px); height: clamp(28px, 5vw, 40px); border: 2px solid ${isPluggedIn ? '#4CAF50' : 'rgba(255,255,255,0.3)'}; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: clamp(2px, 0.5vw, 4px);">
                        <ha-icon icon="${isPluggedIn ? 'mdi:ev-plug-type1' : 'mdi:power-plug-off'}" style="--mdc-icon-size: clamp(14px, 2.5vw, 20px); color: ${isPluggedIn ? '#4CAF50' : 'rgba(255,255,255,0.7)'};"></ha-icon>
                      </div>
                      <span style="font-size: clamp(8px, 1.5vw, 11px); color: ${isPluggedIn ? '#4CAF50' : 'rgba(255,255,255,0.6)'};">${isPluggedIn ? 'Plugged' : 'Unplugged'}</span>
                    </div>

                    <!-- Doors/Windows status -->
                    <div style="display: flex; flex-direction: column; align-items: center; padding: clamp(8px, 1.5vw, 12px) clamp(3px, 0.6vw, 6px); background: ${(doorsOpen || windowsOpen || trunkOpen || hoodOpen) ? 'rgba(255,193,7,0.2)' : 'rgba(76,175,80,0.2)'}; border: 1px solid ${(doorsOpen || windowsOpen || trunkOpen || hoodOpen) ? 'rgba(255,193,7,0.4)' : 'rgba(76,175,80,0.4)'}; border-radius: clamp(8px, 1.5vw, 12px);">
                      <div style="width: clamp(28px, 5vw, 40px); height: clamp(28px, 5vw, 40px); border: 2px solid ${(doorsOpen || windowsOpen || trunkOpen || hoodOpen) ? '#FFC107' : '#4CAF50'}; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: clamp(2px, 0.5vw, 4px);">
                        <ha-icon icon="${(doorsOpen || windowsOpen || trunkOpen || hoodOpen) ? 'mdi:car-door' : 'mdi:shield-check'}" style="--mdc-icon-size: clamp(14px, 2.5vw, 20px); color: ${(doorsOpen || windowsOpen || trunkOpen || hoodOpen) ? '#FFC107' : '#4CAF50'};"></ha-icon>
                      </div>
                      <span style="font-size: clamp(8px, 1.5vw, 11px); color: ${(doorsOpen || windowsOpen || trunkOpen || hoodOpen) ? '#FFC107' : '#4CAF50'};">${(doorsOpen || windowsOpen || trunkOpen || hoodOpen) ? 'Open' : 'Secure'}</span>
                    </div>
                  </div>

                  <!-- Last Update / Next Poll Info -->
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-top: clamp(8px, 1.5vw, 12px); padding-top: clamp(6px, 1vw, 10px); border-top: 1px solid rgba(255,255,255,0.1); font-size: clamp(9px, 1.6vw, 11px);">
                    <div style="display: flex; align-items: center; gap: 4px; color: ${isStale ? '#FFC107' : 'rgba(255,255,255,0.5)'};">
                      <ha-icon icon="${isStale ? 'mdi:alert-circle' : 'mdi:update'}" style="--mdc-icon-size: 12px; color: ${isStale ? '#FFC107' : 'rgba(255,255,255,0.4)'};}"></ha-icon>
                      <span>Updated ${lastUpdateText}</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 4px; color: rgba(255,255,255,0.5);">
                      <ha-icon icon="mdi:clock-outline" style="--mdc-icon-size: 12px; color: rgba(255,255,255,0.4);"></ha-icon>
                      <span>Next ${nextUpdateText}</span>
                    </div>
                  </div>
                </div>
              `;
            ]]]
        extra_styles: |
          @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
          }
          @keyframes charging-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
          }

      # ===== REFRESH BUTTON (small, bottom-right of car card) =====
      - type: custom:button-card
        view_layout:
          grid-area: car
          place-self: end end
          margin: 0 20px 24px 0
        entity: sensor.vinfast_battery
        show_name: true
        show_icon: true
        show_state: false
        name: Now
        icon: mdi:refresh
        tap_action:
          action: call-service
          service: homeassistant.update_entity
          service_data:
            entity_id: sensor.vinfast_battery
        styles:
          card:
            - background: rgba(255,255,255,0.1)
            - border: 1px solid rgba(255,255,255,0.15)
            - border-radius: 6px
            - padding: 4px 8px
            - box-shadow: none
            - cursor: pointer
            - width: auto
            - height: auto
          grid:
            - grid-template-areas: '"i n"'
            - grid-template-columns: auto auto
          icon:
            - color: rgba(255,255,255,0.6)
            - width: 11px
            - height: 11px
          name:
            - font-size: 10px
            - color: rgba(255,255,255,0.6)
            - margin-left: 3px

      # ===== ENERGY SECTION =====
      - type: custom:button-card
        view_layout:
          grid-area: energy
        entity: sensor.gas_savings_today
        show_name: false
        show_icon: false
        show_state: false
        styles:
          card:
            - background: none
            - box-shadow: none
            - border: none
            - padding: 10px 16px 10px 0
          grid:
            - grid-template-areas: '"content"'
            - grid-template-columns: 1fr
            - width: 100%
          custom_fields:
            content:
              - width: 100%
        custom_fields:
          content: |
            [[[
              const today = parseFloat(states['sensor.gas_savings_today']?.state) || 0;
              const month = parseFloat(states['sensor.gas_savings_31_days']?.state) || 0;
              const percent = parseFloat(states['sensor.gas_savings_percent']?.state) || 0;

              const formatMoney = (val) => {
                const isNeg = val < 0;
                return (isNeg ? '-$' : '$') + Math.abs(val).toFixed(2);
              };

              const getColor = (val) => val >= 0 ? '#4CAF50' : '#f44336';

              return `
                <div style="display: flex; align-items: center; gap: clamp(8px, 1.5vw, 12px); margin-bottom: clamp(10px, 2vw, 14px);">
                  <ha-icon icon="mdi:leaf" style="--mdc-icon-size: clamp(28px, 5vw, 36px); color: #4CAF50; filter: drop-shadow(0 4px 12px rgba(0,0,0,0.4));"></ha-icon>
                  <span style="font-size: clamp(14px, 2.5vw, 18px); font-weight: 500; color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.5);">EV Savings</span>
                </div>
                <div style="font-size: clamp(11px, 2vw, 14px); color: rgba(255,255,255,0.7);">
                  <div style="display: flex; justify-content: space-between; padding: clamp(2px, 0.5vw, 4px) 0;">
                    <span>Today:</span>
                    <span style="color: ${getColor(today)}; text-shadow: 0 0 10px ${getColor(today)}40;">${formatMoney(today)}</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; padding: clamp(2px, 0.5vw, 4px) 0;">
                    <span>Month:</span>
                    <span style="color: ${getColor(month)}; text-shadow: 0 0 10px ${getColor(month)}40;">${formatMoney(month)}</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; padding: clamp(2px, 0.5vw, 4px) 0;">
                    <span>vs Gas:</span>
                    <span style="color: ${getColor(percent)};">${percent > 0 ? '+' : ''}${percent}%</span>
                  </div>
                </div>
              `;
            ]]]


      # ===== SECURITY SECTION (Center Bottom) =====
      - type: custom:button-card
        view_layout:
          grid-area: security
        entity: alarm_control_panel.home_alarm
        show_name: false
        show_icon: false
        show_state: false
        tap_action:
          action: more-info
        card_mod:
          style: |
            ha-card {
              background: rgba(255,255,255,0.05) !important;
              backdrop-filter: blur(20px);
              -webkit-backdrop-filter: blur(20px);
              border: 1px solid rgba(255,255,255,0.1);
              border-radius: 24px;
              box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            }
        styles:
          card:
            - padding: 12px
            - cursor: pointer
          grid:
            - grid-template-areas: '"content"'
            - grid-template-columns: 1fr
            - width: 100%
          custom_fields:
            content:
              - width: 100%
        custom_fields:
          content: |
            [[[
              const alarm = entity;
              const alarmState = alarm?.state || 'unknown';
              const garageDoor = states['binary_sensor.garage_door']?.state || 'off';

              // VinFast security status
              const carLocked = states['binary_sensor.vinfast_locked']?.state === 'off';
              const carLocation = states['device_tracker.vinfast_location']?.state || 'unknown';

              let alarmColor = 'rgba(255,255,255,0.4)';
              let alarmText = alarmState;
              let alarmIcon = 'mdi:shield-home';
              if (alarmState === 'armed_away') { alarmColor = '#f44336'; alarmText = 'Armed Away'; alarmIcon = 'mdi:shield-lock'; }
              else if (alarmState === 'armed_home') { alarmColor = '#FFC107'; alarmText = 'Armed Home'; alarmIcon = 'mdi:shield-home'; }
              else if (alarmState === 'disarmed') { alarmColor = '#4CAF50'; alarmText = 'Disarmed'; alarmIcon = 'mdi:shield-check'; }

              return `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                  <div style="display: flex; flex-direction: column; align-items: center; padding: 16px; background: rgba(255,255,255,0.05); border-radius: 16px;">
                    <ha-icon icon="${alarmIcon}" style="--mdc-icon-size: 48px; color: ${alarmColor}; margin-bottom: 8px;"></ha-icon>
                    <span style="font-size: 14px; font-weight: 500; color: white;">Alarm</span>
                    <span style="font-size: 11px; color: rgba(255,255,255,0.5);">${alarmText}</span>
                  </div>
                  <div style="display: flex; flex-direction: column; align-items: center; padding: 16px; background: rgba(255,255,255,0.05); border-radius: 16px;">
                    <ha-icon icon="${garageDoor === 'on' ? 'mdi:garage-open-variant' : 'mdi:garage-variant'}" style="--mdc-icon-size: 48px; color: ${garageDoor === 'on' ? '#FFC107' : '#4CAF50'}; margin-bottom: 8px;"></ha-icon>
                    <span style="font-size: 14px; font-weight: 500; color: white;">Garage</span>
                    <span style="font-size: 11px; color: rgba(255,255,255,0.5);">${garageDoor === 'on' ? 'Open' : 'Closed'}</span>
                  </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                  <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 4px; background: rgba(76,175,80,0.15); border-radius: 12px;">
                    <div style="width: 32px; height: 32px; background: #4CAF50; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 4px;">
                      <ha-icon icon="mdi:wifi" style="--mdc-icon-size: 18px; color: white;"></ha-icon>
                    </div>
                    <span style="font-size: 9px; color: #4CAF50; font-weight: 500;">Online</span>
                  </div>
                  <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 4px; background: ${carLocked ? 'rgba(76,175,80,0.15)' : 'rgba(255,193,7,0.15)'}; border-radius: 12px;">
                    <div style="width: 32px; height: 32px; background: ${carLocked ? '#4CAF50' : '#FFC107'}; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 4px;">
                      <ha-icon icon="${carLocked ? 'mdi:car-key' : 'mdi:car-key'}" style="--mdc-icon-size: 18px; color: white;"></ha-icon>
                    </div>
                    <span style="font-size: 9px; color: ${carLocked ? '#4CAF50' : '#FFC107'}; font-weight: 500;">VF8 ${carLocked ? 'Locked' : 'Open'}</span>
                  </div>
                  <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 4px; background: ${carLocation === 'home' ? 'rgba(76,175,80,0.15)' : 'rgba(100,181,246,0.15)'}; border-radius: 12px;">
                    <div style="width: 32px; height: 32px; background: ${carLocation === 'home' ? '#4CAF50' : '#64B5F6'}; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 4px;">
                      <ha-icon icon="${carLocation === 'home' ? 'mdi:home' : 'mdi:map-marker'}" style="--mdc-icon-size: 18px; color: white;"></ha-icon>
                    </div>
                    <span style="font-size: 9px; color: ${carLocation === 'home' ? '#4CAF50' : '#64B5F6'}; font-weight: 500;">VF8 ${carLocation === 'home' ? 'Home' : 'Away'}</span>
                  </div>
                  <div style="display: flex; flex-direction: column; align-items: center; padding: 8px 4px; background: rgba(76,175,80,0.15); border-radius: 12px;">
                    <div style="width: 32px; height: 32px; background: #4CAF50; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 4px;">
                      <ha-icon icon="mdi:check-decagram" style="--mdc-icon-size: 18px; color: white;"></ha-icon>
                    </div>
                    <span style="font-size: 9px; color: #4CAF50; font-weight: 500;">All Good</span>
                  </div>
                </div>
              `;
            ]]]

      # ===== PRESENCE/STATUS (Top Right) =====
      - type: custom:button-card
        view_layout:
          grid-area: status
        entity: person.person_1
        show_name: false
        show_icon: false
        show_state: false
        styles:
          card:
            - background: none
            - box-shadow: none
            - border: none
            - padding: 10px 0
          grid:
            - grid-template-areas: '"content"'
            - grid-template-columns: 1fr
            - width: 100%
          custom_fields:
            content:
              - width: 100%
        custom_fields:
          content: |
            [[[
              const person1Status = states['person.person_1']?.state || 'unknown';
              const person2Status = states['person.person_2']?.state || 'unknown';

              const getStatusColor = (state) => state === 'home' ? '#4CAF50' : 'rgba(255,255,255,0.4)';
              const getStatusText = (state) => state === 'home' ? 'Home' : 'Away';

              return `
                <div style="font-size: clamp(14px, 2.5vw, 18px); font-weight: 500; color: white; margin-bottom: clamp(10px, 2vw, 16px); text-shadow: 0 2px 10px rgba(0,0,0,0.5);">Presence</div>
                <div style="display: flex; flex-direction: column; gap: clamp(8px, 1.5vw, 12px);">
                  <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: clamp(6px, 1.2vw, 10px);">
                      <ha-icon icon="mdi:account" style="--mdc-icon-size: clamp(18px, 3vw, 22px); color: ${getStatusColor(person1Status)}; filter: drop-shadow(0 2px 6px rgba(0,0,0,0.4));"></ha-icon>
                      <span style="font-size: clamp(11px, 2vw, 14px); color: rgba(255,255,255,0.8);">Person 1</span>
                    </div>
                    <span style="font-size: clamp(10px, 1.8vw, 13px); color: ${getStatusColor(person1Status)}; ${person1Status === 'home' ? 'text-shadow: 0 0 10px rgba(76,175,80,0.5);' : ''}">${getStatusText(person1Status)}</span>
                  </div>
                  <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: clamp(6px, 1.2vw, 10px);">
                      <ha-icon icon="mdi:account" style="--mdc-icon-size: clamp(18px, 3vw, 22px); color: ${getStatusColor(person2Status)}; filter: drop-shadow(0 2px 6px rgba(0,0,0,0.4));"></ha-icon>
                      <span style="font-size: clamp(11px, 2vw, 14px); color: rgba(255,255,255,0.8);">Person 2</span>
                    </div>
                    <span style="font-size: clamp(10px, 1.8vw, 13px); color: ${getStatusColor(person2Status)}; ${person2Status === 'home' ? 'text-shadow: 0 0 10px rgba(76,175,80,0.5);' : ''}">${getStatusText(person2Status)}</span>
                  </div>
                </div>
              `;
            ]]]

      # ===== BATTERY STATUS (Right Column) =====
      - type: custom:button-card
        view_layout:
          grid-area: battery
        entity: sensor.phone_1_battery_level
        show_name: false
        show_icon: false
        show_state: false
        styles:
          card:
            - background: none
            - box-shadow: none
            - border: none
            - padding: 10px 0
          grid:
            - grid-template-areas: '"content"'
            - grid-template-columns: 1fr
            - width: 100%
          custom_fields:
            content:
              - width: 100%
        custom_fields:
          content: |
            [[[
              const getColor = (level) => level < 20 ? '#f44336' : (level < 50 ? '#FFC107' : '#4CAF50');
              const getGlow = (level) => level < 20 ? 'text-shadow: 0 0 10px rgba(244,67,54,0.5);' : (level < 50 ? 'text-shadow: 0 0 10px rgba(255,193,7,0.5);' : 'text-shadow: 0 0 10px rgba(76,175,80,0.5);');

              // Phone batteries (REQUIRED - from Mobile App integration)
              const person1 = parseInt(states['sensor.phone_1_battery_level']?.state) || 0;
              const person2 = parseInt(states['sensor.phone_2_battery_level']?.state) || 0;

              // Camera batteries (OPTIONAL - remove lines 683-686 and corresponding HTML if you don't have cameras)
              const camera1 = parseInt(states['sensor.camera_1_battery_level']?.state) || 0;
              const camera2 = parseInt(states['sensor.camera_2_battery_level']?.state) || 0;
              const camera3 = parseInt(states['sensor.camera_3_battery_level']?.state) || 0;
              const camera4 = parseInt(states['sensor.camera_4_battery_level']?.state) || 0;

              return `
                <div style="font-size: clamp(14px, 2.5vw, 18px); font-weight: 500; color: white; margin-bottom: clamp(10px, 2vw, 16px); text-shadow: 0 2px 10px rgba(0,0,0,0.5);">Battery Status</div>
                <div style="display: flex; flex-direction: column; gap: clamp(5px, 1vw, 8px);">
                  <!-- Phone Batteries (REQUIRED) -->
                  <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: clamp(5px, 1vw, 8px);">
                      <ha-icon icon="mdi:cellphone" style="--mdc-icon-size: clamp(12px, 2vw, 16px); color: ${getColor(person1)}; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));"></ha-icon>
                      <span style="font-size: clamp(10px, 1.8vw, 13px); color: rgba(255,255,255,0.7);">Person 1</span>
                    </div>
                    <span style="font-size: clamp(10px, 1.8vw, 13px); color: ${getColor(person1)}; ${getGlow(person1)}">${person1}%</span>
                  </div>
                  <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: clamp(5px, 1vw, 8px);">
                      <ha-icon icon="mdi:cellphone" style="--mdc-icon-size: clamp(12px, 2vw, 16px); color: ${getColor(person2)}; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));"></ha-icon>
                      <span style="font-size: clamp(10px, 1.8vw, 13px); color: rgba(255,255,255,0.7);">Person 2</span>
                    </div>
                    <span style="font-size: clamp(10px, 1.8vw, 13px); color: ${getColor(person2)}; ${getGlow(person2)}">${person2}%</span>
                  </div>

                  <!-- Camera Batteries (OPTIONAL - remove these 4 sections if you don't have cameras) -->
                  <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: clamp(5px, 1vw, 8px);">
                      <ha-icon icon="mdi:cctv" style="--mdc-icon-size: clamp(12px, 2vw, 16px); color: ${getColor(camera1)}; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));"></ha-icon>
                      <span style="font-size: clamp(10px, 1.8vw, 13px); color: rgba(255,255,255,0.7);">Camera 1</span>
                    </div>
                    <span style="font-size: clamp(10px, 1.8vw, 13px); color: ${getColor(camera1)}; ${getGlow(camera1)}">${camera1}%</span>
                  </div>
                  <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: clamp(5px, 1vw, 8px);">
                      <ha-icon icon="mdi:cctv" style="--mdc-icon-size: clamp(12px, 2vw, 16px); color: ${getColor(camera2)}; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));"></ha-icon>
                      <span style="font-size: clamp(10px, 1.8vw, 13px); color: rgba(255,255,255,0.7);">Camera 2</span>
                    </div>
                    <span style="font-size: clamp(10px, 1.8vw, 13px); color: ${getColor(camera2)}; ${getGlow(camera2)}">${camera2}%</span>
                  </div>
                  <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: clamp(5px, 1vw, 8px);">
                      <ha-icon icon="mdi:cctv" style="--mdc-icon-size: clamp(12px, 2vw, 16px); color: ${getColor(camera3)}; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));"></ha-icon>
                      <span style="font-size: clamp(10px, 1.8vw, 13px); color: rgba(255,255,255,0.7);">Camera 3</span>
                    </div>
                    <span style="font-size: clamp(10px, 1.8vw, 13px); color: ${getColor(camera3)}; ${getGlow(camera3)}">${camera3}%</span>
                  </div>
                  <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: clamp(5px, 1vw, 8px);">
                      <ha-icon icon="mdi:cctv" style="--mdc-icon-size: clamp(12px, 2vw, 16px); color: ${getColor(camera4)}; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));"></ha-icon>
                      <span style="font-size: clamp(10px, 1.8vw, 13px); color: rgba(255,255,255,0.7);">Camera 4</span>
                    </div>
                    <span style="font-size: clamp(10px, 1.8vw, 13px); color: ${getColor(camera4)}; ${getGlow(camera4)}">${camera4}%</span>
                  </div>
                </div>
              `;
            ]]]

      # ===== VF8 LOCATION MAP =====
      - type: map
        view_layout:
          grid-area: map
          align-self: start
        entities:
          - entity: device_tracker.vinfast_location
            name: VF8
        dark_mode: true
        default_zoom: 15
        hours_to_show: 0
        tap_action:
          action: more-info
        card_mod:
          style: |
            ha-card {
              background: rgba(255,255,255,0.05) !important;
              backdrop-filter: blur(20px);
              -webkit-backdrop-filter: blur(20px);
              border: 1px solid rgba(255,255,255,0.1);
              border-radius: 16px;
              box-shadow: 0 8px 32px rgba(0,0,0,0.3);
              overflow: hidden;
              height: clamp(240px, 45vw, 450px) !important;
              cursor: pointer;
            }
            @media (max-width: 600px) {
              ha-card {
                height: 280px !important;
              }
            }
            #map, .leaflet-container {
              height: 100% !important;
              min-height: 100% !important;
            }
