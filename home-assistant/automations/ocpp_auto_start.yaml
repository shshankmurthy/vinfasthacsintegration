# =============================================================================
# OCPP Auto-Start Charging Automation
# Automatically starts charging when the vehicle is plugged in
# =============================================================================
#
# Installation:
#   1. Copy this file to /config/automations/ on your Home Assistant
#   2. Add the following to /config/configuration.yaml:
#      automation: !include_dir_merge_list automations/
#   3. Restart Home Assistant
#
# OCPP connector status values:
#   - Available:    Ready, no vehicle connected
#   - Preparing:    Vehicle plugged in, waiting to start
#   - Charging:     Actively charging
#   - SuspendedEV:  Paused by vehicle
#   - SuspendedEVSE: Paused by charger
#   - Finishing:    Session ending
#   - Unavailable:  Charger not available
# =============================================================================

- id: ocpp_auto_start_charging
  alias: "OCPP - Auto Start Charging"
  description: "Automatically start charging when vehicle is plugged in"
  trigger:
    # Trigger when connector status changes to "Preparing" (vehicle plugged in)
    - platform: state
      entity_id: sensor.charger_status_connector
      to: "Preparing"
  condition:
    # Only start if charger is available
    - condition: state
      entity_id: switch.charger_availability
      state: "on"
    # Don't start if already charging
    - condition: not
      conditions:
        - condition: state
          entity_id: switch.charger_charge_control
          state: "on"
  action:
    # Wait for vehicle to be ready
    - delay:
        seconds: 3
    # Start charging
    - service: switch.turn_on
      target:
        entity_id: switch.charger_charge_control
  mode: single
